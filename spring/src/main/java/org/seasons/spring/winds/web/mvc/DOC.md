
参照SpringBoot使用内嵌Tomcat的方式，在SpringFramework环境下使用内嵌Tomcat

使用内嵌的Tomcat容器，基于注解的配置类

由tomcat容器启动应用  

先启动tomcat，在tomcat的配置文件中(web.xml)，配置一个Listener，tomcat容器会回调此监听器，然后在此监听器中启动SpringFramework上下文

Servlet容器启动后通知ContextLoaderListener，然后创建Spring的ApplicationContext
Servlet3.0+之后，提供了代码配置的方式(替代基于web.xml的配置方式)，Servlet容器通过SPI(Service Provider Interface)，
来查找实现了ServletContainerInitializer的类，然后进行初始化回调。Spring在spring-web包下已经有了相应的SPI配置文件，只要Servlet容器
启动后，依赖中存在spring-web包，就能从META-INF目录下读取到javax.servlet.ServletContainerInitializer文件，从而进行回调。

越来越多的应用使用SpringBoot，而SpringBoot是一个fatjar，整体应用打包成一个jar文件，里面包含了所有依赖的jar，如果是一个web服务，
自然也要把Servlet容器包含进去，尤其是使用比较广泛的Tomcat
fatjar是先启动Spring容器，然后再去启动Servlet容器，这样跟之前的方式就完全相反，需要调整实现。

直接启动应用

在Spring上下文启动过程中，有个阶段是onRefresh，这个阶段可以作为启动Servlet容器的时机，传统的WebApplicationContext上下文是在
ServletContext创建后才开始创建，所以依赖顺序也要发生变化。

原有启动逻辑中依赖ServletContext的方式为Aware(ServletContextAware)的注入方式，为此有一个专门的类来进行处理：ServletContextAwareProcessor，这是一个
BeanPostProcessor，BeanPostProcessor实例的创建是在ApplicationContext#refresh方法中的postProcessBeanFactory过程中，
向BeanFactory中添加BeanPostProcessor，而ServletContextAwareProcessor的构造参数就包含ServletContext实例。

在先启动SpringApplicationContext后启动ServletContext的方式下，显而易见是无法顺利处理ServletContextAware的，因为此时并没有ServletContext实例产生

在refresh的过程中，提供一个扩展点，onRefresh方法，在onRefresh方法中解决ServletContext容器的启动。

先前的处理ServletContextAware的方式，不满足当前的需求，因此需要重新实现WebApplicationContext以及ServletContextAwareProcessor，
前者用于重写onRefresh方法启动Servlet容器，以及重写postProcessBeanFactory为了向BeanFactory注入新的ServletContextAwareProcessor，
新的AwareProcessor重写getServletContext方法，从当前的WebApplicationContext中获取ServletContext实例，当前WebApplicationContext
中的ServletContext实例是通过onRefresh方法调用中启动Servlet容器实例获得的。


而对ServletContextAware类型的Bean的处理还在之后的阶段，Aware类型的Bean处理时，通过BeanPostProcessor，就能顺利注入ServletContext实例。




filter 

handle执行前后的扩展点 

自定义参数解析  HandlerMethodArgumentResolver 

返回值解析   HandlerMethodReturnValueHandler 不同类型的返回类型（content-type）,使用不同的Handler，同时根据具体的值类型（Map POJO String等）来进行消息内容转换 

都涉及到converter，


handler方法最终会通过反射获取Method对象，然后包装成 InvocableHandlerMethod  这一步哪里处理？


DataBinder

WebDataBinder 将Web请求参数绑定到JavaBean对象上 